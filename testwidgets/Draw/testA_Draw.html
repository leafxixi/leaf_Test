<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <title>robot testA_Draw</title>

  <style>
    @import "http://leaf:3344/arcgis_js_api/310/js/dojo/util/doh/robot/robot.css";
  </style>

  <!-- required: dojo.js -->
  <script type="text/javascript" src="http://leaf:3344/arcgis_js_api/310/js/dojo/dojo/dojo.js"
    data-dojo-config="isDebug: true"></script>
  <script type="text/javascript">
    require(["doh", "dojo/dom", "dojo/robotx", "dojo/keys", "dojo/domReady!"], 
    function(doh, dom, robot, keys){
      robot.initRobot('http://leaf:3344/webappbuilder/apps/9/');
        doh.register('testA_Draw', {
          name: 'testA_Draw',
          timeout: 100000,
          setUp: function(){
            console.log(robot.doc);
          },

          runTest: function(){
            var def = new doh.Deferred();
            console.log(Date.now());
            robot.sequence(function(){
            // start
              robot.window.require(["dojo/query", 'dijit/registry'], 
              function(query, registry){                
                var titleAssert=query(".title")[1];
                console.log(titleAssert);
                console.log(Date.now());
                //doh.assertTrue((titleAssert.innerText=="ArcGIS Web Application"));
                if(titleAssert.innerText=="ArcGIS Web Application")
                  console.log("name is right");
                else
                  console.log("name is wrong");
                var Draw = query("[title=Draw]")[0];
                console.log(Draw);
                console.log(Date.now());
                robot.mouseMoveAt(Draw, 100, 1000);
                robot.mouseClick({left:true, middle:false, right:false}, 100);
                //select mode
                robot.sequence(function(){
                  var action = query("[data-geotype=CIRCLE]")[0];
                  console.log(action);
                  console.log(Date.now());
                  robot.mouseMoveAt(action, 100, 1000);
                  robot.mouseClick({left:true, middle:false, right:false}, 100);
                  //select its shape, color, alpha, outline color, outline width
                  action = query(".icon-table.fill-icon-table.fill-icon-table-fill")[0].firstChild.firstChild.lastChild;
                  console.log(action);
                  console.log(Date.now());
                  robot.mouseMoveAt(action, 100, 1000);
                  robot.mouseClick({left:true, middle:false, right:false}, 100);
                  action = query(".jimu-color-picker")[15];
                  console.log(action);
                  console.log(Date.now());
                  robot.mouseMoveAt(action, 100, 1000);
                  robot.mouseClick({left:true, middle:false, right:false}, 100);
                  //select color
                  robot.sequence(function(){
                    action = query("td[title=橙色]")[0];
                    console.log(action);
                    console.log(Date.now());
                    robot.mouseMoveAt(action, 100, 1000);
                    robot.mouseClick({left:true, middle:false, right:false}, 100);
                    action = query(".dijitReset.dijitInputInner")[21];
                    console.log(action);
                    console.log(Date.now());
                    robot.mouseMoveAt(action, 100, 1000);
                    robot.mouseClick({left:true, middle:false, right:false}, 100);
                    robot.keyPress(keys.TAB,0);
                    robot.keyPress(keys.TAB,0,{shift:true});
                    robot.typeKeys("0.2",100,200);
                    action = query(".jimu-color-picker")[16];
                    console.log(action);
                    console.log(Date.now());
                    robot.mouseMoveAt(action, 100, 1000);
                    robot.mouseClick({left:true, middle:false, right:false}, 100);
                    //select outline color
                    robot.sequence(function(){
                      action = query("td[title=绯红色]")[1];
                      console.log(action);
                      console.log(Date.now());
                      robot.mouseMoveAt(action, 100, 1000);
                      robot.mouseClick({left:true, middle:false, right:false}, 100);
                      action = query(".dijitReset.dijitInputInner")[22];
                      console.log(action);
                      console.log(Date.now());
                      robot.mouseMoveAt(action, 100, 1000);
                      robot.mouseClick({left:true, middle:false, right:false}, 100);
                      robot.keyPress(keys.TAB,0);
                      robot.keyPress(keys.TAB,0,{shift:true});
                      robot.typeKeys("5",100,200);
                      //click show measure
                      action = query("[data-dojo-attach-point=showMeasure]")[0];
                      console.log(action);
                      console.log(Date.now());
                      robot.mouseMoveAt(action, 100, 1000);
                      robot.mouseClick({left:true, middle:false, right:false}, 100);
                      action = query(".dijitReset.dijitInputField.dijitButtonText")[8];
                      console.log(action);
                      console.log(Date.now());
                      robot.mouseMoveAt(action, 100, 1000);
                      robot.mouseClick({left:true, middle:false, right:false}, 100);
                      //select area unit
                      robot.sequence(function(){
                        action = query(".dijitReset.dijitMenuItem[role=option]")[3];
                        console.log(action);
                        console.log(Date.now());
                        robot.mouseMoveAt(action, 100, 1000);
                        robot.mouseClick({left:true, middle:false, right:false}, 100);
                        action = query(".dijitReset.dijitInputField.dijitButtonText")[9];
                        console.log(action);
                        console.log(Date.now());
                        robot.mouseMoveAt(action, 100, 1000);
                        robot.mouseClick({left:true, middle:false, right:false}, 100);
                        //select distance unit
                        robot.sequence(function(){
                          action = query(".dijitReset.dijitMenuItem[role=option]")[11];
                          console.log(action);
                          console.log(Date.now());
                          robot.mouseMoveAt(action, 100, 1000);
                          robot.mouseClick({left:true, middle:false, right:false}, 100);
                          //draw a circle in map
                          action = query(".layersDiv")[0];
                          console.log(action);
                          console.log(Date.now());
                          robot.mouseMoveAt(action, 100, 1000);
                          robot.mousePress({left: true, middle:false, right:false}, 300);
                          robot.mouseMoveAt(action, 200, 2000, Number(400),Number(300));
                          robot.mouseRelease({left: true, middle:false, right:false}, 300);
                          //clear
                          robot.sequence(function(){
                            var doh_handler = query(".layersDiv")[0].lastChild.childNodes[7];
                            var doh_clear_1 = doh_handler.childNodes.length;
                            //doh check
                            var doh_color = doh_handler.childNodes[1].getAttribute("fill")=="rgb(255, 165, 0)";
                            var doh_alpha = doh_handler.childNodes[1].getAttribute("fill-opacity")==0.2;
                            var doh_outline_color = doh_handler.childNodes[1].getAttribute("stroke")=="rgb(220, 20, 60)";
                            var doh_outline_width = doh_handler.childNodes[1].getAttribute("stroke-width")==5;
                            var doh_measure_area = query(".dijitReset.dijitInline.dijitSelectLabel.dijitValidationTextBoxLabel")[8].parentNode.parentNode.lastChild.value=="HECTARES";
                            var doh_measure_distance = query(".dijitReset.dijitInline.dijitSelectLabel.dijitValidationTextBoxLabel")[9].parentNode.parentNode.lastChild.value=="YARDS";
                            console.log(doh_handler); 
                            console.log(doh_handler.childNodes[1]);  
                            console.log(doh_handler.lastChild); 
                            console.log(doh_color+"  &  "+doh_alpha+"  &  "+doh_outline_color+"  &  "+doh_outline_width+"  &  ");
                            console.log(doh_measure_area); 
                            console.log(doh_measure_distance); 
                            action = query(".drawings-clear")[0];
                            console.log(action);
                            console.log(Date.now());
                            robot.mouseMoveAt(action, 100, 1000);
                            robot.mouseClick({left:true, middle:false, right:false}, 100);
                            //添加断言        
                            robot.sequence(def.getTestCallback(function(){
                              //doh check 2
                              var doh_clear_2 = doh_handler.childNodes.length;
                              console.log(doh_clear_1+" & "+doh_clear_2);
                              doh.t(doh_color,"color has been changed!");
                              doh.t(doh_alpha,"alpha has been changed!");
                              doh.t(doh_outline_color,"outline color has been changed!");
                              doh.t(doh_outline_width,"outline width has been changed!");
                              doh.t(doh_measure_distance,"measure distance has been changed!");
                              doh.t(doh_measure_area,"measure area has been changed!");
                              doh.t(doh_clear_1,doh_clear_2,"clear button has been clicked!");

                            }), 3000);//添加断言  
                          },2000);//clear
                        },2000);//select distance unit
                      },2000);//select area unit
                    },2000);//select outline color
                  },2000);//select color
                },2000);//select mode
              }); // start
            }, 8000);               
            return def;
          }
        });
      doh.run();
    });
  // robot.sequence(function(){
  // },2000);
  //添加断言        
  // robot.sequence(def.getTestCallback(function(){
  //   console.log('doh_testing:');                          
  //   doh.is("widget-node hide moveable",doh_visibility,"Coordinate visibility has been changed!");
  // }), 3000);//添加断言  
  </script>
</head>
</html>
